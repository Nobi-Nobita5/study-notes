Q1：什么是**Java栈中**存放的**动态链接**？

1.Java源文件被编译到字节码文件中时，**类和接口的全限定名、字段名称描述符、方法名称描述符作为符号引用（Symbolic Reference）先被保存在class文件的常量池里**。**当 Class 文件被加载到内存后，Java虚拟机会将 Class 文件常量池里的内容转移到运行时常量池里，即编译期间生成的字面量、符号引用**(运行时常量池也是每个类都有一个)。

2.一个方法对应一个栈帧。每一个栈帧中都包含一个指向方法区的**运行时常量池**中该栈帧所属方法的引用。

3.所以动态链接又称为**指向运行时常量池的方法引用**。

例如：class文件描述一个方法调用了另外其他的方法时，就是通过class常量池中指向方法的符号引用来表示的，动态链接的作用是为了将这些符号引用转换为**方法区中调用方法的直接(原始)引用**。



**Q2：什么是符号引用和直接引用？**

解析一:
符号引用就是一个类中（当然不仅是类，还包括类的其他部分，比如方法，字段等），引入了其他的类，可是JVM并不知道引入的其他类在哪里，所以就用唯一符号来代替，等到类加载器去解析的时候，就把符号引用找到那个引用类的地址，这个地址也就是直接引用。

解析二:
1.符号引用（Symbolic References）：

符号引用以一组符号来描述所引用的目标，符号可以是任何形式的字面量，只要使用时能够无歧义的定位到目标即可。例如，在Class文件中它以CONSTANT_Class_info、CONSTANT_Fieldref_info、CONSTANT_Methodref_info等类型的常量出现。**符号引用与虚拟机的内存布局无关，引用的目标并不一定加载到内存中**。在Java中，一个java类将会编译成一个class文件。在编译时，java类并不知道所引用的类的实际地址，因此只能使用符号引用来代替。比如org.simple.People类引用了org.simple.Language类，在编译时People类并不知道Language类的实际内存地址，因此只能使用符号org.simple.Language（假设是这个，当然实际中是由类似于CONSTANT_Class_info的常量来表示的）来表示Language类的地址。各种虚拟机实现的内存布局可能有所不同，但是它们能接受的符号引用都是一致的，因为符号引用的字面量形式明确定义在Java虚拟机规范的Class文件格式中。

2.直接引用：
直接引用可以是
（1）**直接指向目标的指针**（比如，指向“类型”【Class对象】、类变量、类方法的直接引用可能是指向**方法区**的指针）
（2）**相对偏移量**（比如，指向实例变量、实例方法的直接引用都是偏移量）
（3）**一个能间接定位到目标的句柄**
直接引用是和虚拟机的布局相关的，同一个符号引用在不同的虚拟机实例上翻译出来的直接引用一般不会相同。**如果有了直接引用，那引用的目标必定已经被加载入内存中了**。

解析三:
符号引用即用**(用字符串符号的形式)**来表示引用，其实被引用的类、方法或者变量还没有被加载到内存中。而直接引用则是有具体引用地址的指针，被引用的类、方法或者变量已经被加载到内存中。以变量举个例子：

![](https://springboot-vue-blog.oss-cn-hangzhou.aliyuncs.com/img-for-typora/%E7%AC%A6%E5%8F%B7%E5%BC%95%E7%94%A8%E5%92%8C%E7%9B%B4%E6%8E%A5%E5%BC%95%E7%94%A8.png)

符号引用要转换成直接引用才有效，这也说明直接引用的效率要比符号引用高。**那为什么要用符号引用呢？这是因为类加载之前，javac会将源代码编译成.class文件，这个时候javac是不知道被编译的类中所引用的类、方法或者变量他们的引用地址在哪里，所以只能用符号引用来表示，当然，符号引用是要遵循java虚拟机规范的。**还有一种情况需要用符号引用，就例如前文举得变量的符号引用的例子，是为了逻辑清晰和代码的可读性。
javac在编译一个A类时,如果A类应用了B类,那么javac到类路径下找B类,如果找到了,就把A类编译成A.class文件,这时A.class文件中有个B类的符号引用(字符串形式),这个可以自己写两个A类和B类,A类引用B类,编译A类后,使用JDK自带反编译工具,反编译出代码看

我们都知道，**类加载过程分为加载—>验证—>准备—>解析—>初始化这 5个阶段，符号引用转换为直接引用就发生在解析阶段**，解析阶段可能在初始化前，也可能在初始化之后。



参考：https://blog.csdn.net/weixin_41490593/article/details/95110259