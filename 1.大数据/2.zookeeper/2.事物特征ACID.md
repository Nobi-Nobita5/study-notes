> 事物具有四个特征，分别是一致性(Consistency)、原子性(Atomicity)、隔离性(Isolation)、持久性(Durability)，简称为事物的ACID特性。

##### 一、一致性

数据库的数据状态符合数据库所描述的业务逻辑和规则。

一致性强调的是业务逻辑和规则的一致性状态。实际上，AID三大特性都是为了实现C。

​		例如在A向B转账的案例中，A的账户减去1000，B的账户加上1000，已经实现了原子性操作。但如果在A的账户减去1000之后，数据库系统突然宕机，该事务就被迫中断，无法利用**原子性**回滚。为了解决这种由于数据库系统宕机导致的不一致状态问题，可以利用**持久性**，向日志中多加一个状态，用来标记该操作是否执行，然后用一个定时器，每隔几秒找出日志中没有完成的事务并把它执行完。

​		上述案例没有提到的隔离性是为了保证并发事务是相互隔离的。可以发现，AID三大特性最终的结果都是为了实现**事务的一致性**。

##### 二、原子性

事物中包含的各项操作再一次执行过程中，只允许出现以下两种状态之一。

* 全部执行成功
* 全部执行失败

##### 三、隔离性

事务的隔离性，是指在并发环境中，并发的事务是相互隔离的，并发执行的各个事务之间不能相互干扰。

1. 在标准SQL规范之中，定义了四个事务隔离级别。不同的隔离级别对事物的处理不同。如**读未提交(Read Uncommitted)，读已提交(Read Committed)，可重复读(Repeatable Read)，串行化(Serializable)**。

   串行化是最严谨的事务隔离级别，事务只能一个接一个的处理，【不能并发执行】。串行化是一致性最好的，性能最差的。在互联网大数据量，高并发量的场景下，一般不会使用 Serializable 和Read uncommitted 这两种隔离级别。

2. 读未提交、读已提交、可重复读 在事务并发执行时 都可能会出现一个问题：【一个事务范围内的多次查询却返回了不同的结果】。

3. 前三种隔离级别出现上述问题的原因：

​	1）**脏读**

​		读未提交会出现。脏读是指对于数据库中的某个数据项，一个事务范围内的多次查询却返回了不同的结果，这是因为读取了到另一个事务【未提交】的数据。

​	2）**不可重复度**

​		读已提交会出现。不可重复读是指对于数据库中的某个数据项，一个事务范围内的多次查询却返回了不同的结果，这是因为读取了到另一个事务【已提交】的数据。因此该事务级别可以避免【脏读】。

​	3）**幻读**

​		可重复读会出现。**它是MYSQL(InnoDB引擎)默认的隔离级别**。可重复读保证事务在处理过程中，【多次读取同一个数据项时，其值都和事务开始时刻是一致的】。因此该事务级别可以避免【脏读】和【不可重复读】。但对于【同一批数据整体】来说，一个事务范围内的多次读取就可能出现【幻读】。

```java
例如事务T1对一个表中所有的行的某个数据项做了从“1”修改为“2”的操作，这时事务T2又对这个表中插入了一行数据项，而这个数据项的数值还是为“1”并且提交给数据库。而操作事务T1的用户如果再查看刚刚修改的数据，会发现还有一行没有修改，其实这行是从事务T2中添加的，就好像产生幻觉一样，这就是发生了幻读。
```
​		幻读和不可重复读都是读取了另一条已经提交的事务（这点就脏读不同），**所不同的是不可重复读查询的都是同一个数据项，而幻读针对的是一批数据整体**。

​		总的来说，解决不可重复读的方法是**锁行**，解决幻读的方式是**锁表**，当然，是加读锁(共享锁)。

> 当一个事务对表或者特定行加了读锁（Shared Lock）后，该事务本身是不能修改已经加锁的数据的。这是因为**读锁是共享锁**，它允许其他事务也可以读取已经加锁的数据，但是任何事务（包括加锁的事务本身）都不能修改这些数据。这种机制能够保证数据的一致性。
>
> **如果一个事务需要修改数据，那么它需要加写锁（Exclusive Lock）而不是读锁**。**写锁是排他锁**，它不仅阻止其他事务修改已经加锁的数据，也阻止其他事务读取这些数据。

**比如当前存在脏读问题，又不想通过加锁等待其他事务处理完成，那么可以调整隔离级别到读已提交，那么MySQL的InnoDB引擎会使用自动启用的MVCC"多版本并发控制"（Multi-Version Concurrency Control）实现数据库管理系统（DBMS）的并发控制方法。做到不加锁，非阻塞并发读。**

##### 四、持久性

事务的持久性是指一个事务一旦提交，他对数据库中对应的数据状态的变更就应该是永久性的。





参考博客：

原子性和一致性的区别：https://blog.csdn.net/qq_32069155/article/details/100902969

数据库的四种隔离级别：https://blog.csdn.net/u010960184/article/details/82557978

参考书籍：《从Paxos到ZooKeeper》

