> 开窗函数语法

~~~
<开窗函数> over ([partition by <列清单>]  -- 用于分z
                        order by <排序用列清单>)
~~~

1. ​	开窗函数可以和group by一起使用，并不冲突。因为开窗函数也是基于整个group by后的查询结果。

   ​	所以只要开窗函数中用到的字段满足group by表达式，就可以一起使用

#### 开窗函数分两类：一类是聚合*开窗函数*，一类是排序*开窗函数*。

> 排序类窗口函数

##### 一、lag() 和 lead()用法

1. lag和lead分别是向前向后的意思

2. 参数有三个。

   **expression**：列名；

   **offset**：偏移量,即向前或向后第几行,默认1；

   **default_value**：超出记录窗口的默认值(默认为null，可以设置为0)

3. 即向前或向后(即向下)取第某行的字段数据

##### 二、row_number(),rank(),dense_rank()

1. row_number()分组内遇到重复的依然会输出连续序号
2. rank()分组内遇到重复的会分配相同的序号，但接下来的序号会隔开，如1，2，2，4...
3. dense_rank()分组内遇到重复的会分配相同的序号，且接下来的序号不会隔开，如1，2，2，3...

##### 三、first_value(),last_value()

> 聚合类窗口函数

##### 一、sum() over (order by )、count()、max()、min()、avg()等

​	sum(a) over (order by b) 的含义是: 按b列排序，（分组内）按b列的排序将a依次相加。

​	**实际上，所有窗口函数都一样，运用了开窗函数后都是在分组内根据order by 排序的字段依次计算。**